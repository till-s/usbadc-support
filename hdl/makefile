# Makefile automatically generated by ghdl
# Version: GHDL 1.0.0 (1.0.0.r0.g2fb2384d) [Dunoon edition] - GCC back-end code generator
# Command used to generate this makefile:
# ghdl --gen-makefile CommandWrapperTb

GHDL=ghdl
#GHDLFLAGS=-P/opt/ghdl/v1.0.0-gcc/ise-14.7/
GHDLFLAGS=-P/opt/ghdl/v2.0.0-gcc/vivado-2021.2/ -fsynopsys -Wl,-no-pie -g

# BRAM or SDRAM
SAMPLEBUFFER_TYPE=SDRAM

# where to find RamEmul.vhd (if SAMPLEBUFFER_TYPE == SDRAM)
VPATH=../../SDRAMCtrl

HEREDIR:=$(dir $(lastword $(MAKEFILE_LIST)))

# Default target
TESTS= CommandWrapperTb CommandWrapperSim CicFilterTb PipelinedRShifterTb
TESTS+=SpiRegTb SpiShadowRegTb SampleBufferTb SimpleBusAsyncTb SimpleBusPipeStageTb

all: $(TESTS)

test: $(filter-out CommandWrapperSim,$(TESTS))
	for i in $^; do if ! ./$$i; then exit 1; fi done

RAM_EMUL_SDRAM=RamEmul

OBJS+=CommandMuxPkg.o ByteStuffer.o SFifo.o ByteDeStuffer.o
OBJS+=CommandMux.o SynchronizerBit.o BitBangIF.o CommandBitBang.o
OBJS+=MaxAdc.o CommandWrapper.o ILAWrapper.o ILAWrapperPkg.o AcqCtlPkg.o
OBJS+=CicFilter.o CommandAcqParm.o BasicPkg.o PipelinedRShifter.o
OBJS+=MulShifter.o SpiReg.o
OBJS+=CommandVersion.o
OBJS+=CommandSpi.o SpiBitShifter.o
OBJS+=SpiFlashSim.o SpiChecker.o
OBJS+=Flicker.o
OBJS+=CommandReg.o
OBJS+=SampleBufferBRAM.o
OBJS+=SampleBufferSDRAM.o
OBJS+=SDRAMPkg.o
OBJS+=GenericFifoAsync.o
OBJS+=SimpleBusAsync.o
#OBJS+=SinCosGen.o
OBJS+=SimpleBusPipeStage.o
OBJS+=$(addsuffix .o,$(RAM_EMUL_$(SAMPLEBUFFER_TYPE)))

# Elaboration target
CommandWrapperTb: /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/std_logic_1164.o /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/std_logic_1164-body.o /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/numeric_std.o /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/numeric_std-body.o /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/math_real.o /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/math_real-body.o CommandWrapperTb.o $(OBJS)
	$(GHDL) -e $(GHDLFLAGS) -o $@ $@

%Tb: %Tb.o $(OBJS)
	$(GHDL) -e $(GHDLFLAGS) -o $@ $@

CommandWrapperSim: $(OBJS) SimPty.o SimPtyIO.o CommandWrapperSim.o $(OBJS)
	$(GHDL) -e $(GHDLFLAGS) -Wl,SimPtyIO.o -o $@  $@

SampleBufferTb: SampleBufferTb.o SampleBuffer$(SAMPLEBUFFER_TYPE).o SynchronizerBit.o $(addsuffix .o,$(RAM_EMUL_$(SAMPLEBUFFER_TYPE)))
	$(GHDL) -e $(GHDLFLAGS) -o $@  $@

# Run target
run: CommandWrapperTb
	$(GHDL) -r $^ $(GHDLRUNFLAGS)

# Targets to analyze files
/opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/std_logic_1164.o: /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/../../src/ieee/v93/std_logic_1164.vhdl
	@echo "This file was not locally built ($<)"
	exit 1
/opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/std_logic_1164-body.o: /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/../../src/ieee/v93/std_logic_1164-body.vhdl
	@echo "This file was not locally built ($<)"
	exit 1
/opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/numeric_std.o: /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/../../src/ieee/v93/numeric_std.vhdl
	@echo "This file was not locally built ($<)"
	exit 1
/opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/numeric_std-body.o: /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/../../src/ieee/v93/numeric_std-body.vhdl
	@echo "This file was not locally built ($<)"
	exit 1
/opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/math_real.o: /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/../../src/ieee/math_real.vhdl
	@echo "This file was not locally built ($<)"
	exit 1
/opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/math_real-body.o: /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/../../src/ieee/math_real-body.vhdl
	@echo "This file was not locally built ($<)"
	exit 1
CommandMuxPkg.o: CommandMuxPkg.vhd
	$(GHDL) -a $(GHDLFLAGS) $<
ByteStuffer.o: ByteStuffer.vhd
	$(GHDL) -a $(GHDLFLAGS) $<
SFifo.o: SFifo.vhd
	$(GHDL) -a $(GHDLFLAGS) $<
ByteDeStuffer.o: ByteDeStuffer.vhd
	$(GHDL) -a $(GHDLFLAGS) $<
CommandMux.o: CommandMux.vhd ILAWrapperPkg.o
	$(GHDL) -a $(GHDLFLAGS) $<
CommandVersion.o: CommandVersion.vhd CommandMuxPkg.o BasicPkg.o
	$(GHDL) -a $(GHDLFLAGS) $<
SynchronizerBit.o: SynchronizerBit.vhd
	$(GHDL) -a $(GHDLFLAGS) $<
BitBangIF.o: BitBangIF.vhd
	$(GHDL) -a $(GHDLFLAGS) $<
CommandBitBang.o: CommandBitBang.vhd BitBangIF.o
	$(GHDL) -a $(GHDLFLAGS) $<
SimPty.o: SimPty.vhd
	$(GHDL) -a $(GHDLFLAGS) $<
MaxAdc.o: MaxAdc.vhd SampleBufferBRAM.o SampleBufferSDRAM.o SDRAMPkg.o
	$(GHDL) -a $(GHDLFLAGS) $<
CommandWrapper.o: CommandWrapper.vhd SDRAMPkg.o CommandVersion.o
	$(GHDL) -a $(GHDLFLAGS) $<
CommandWrapperTb.o: CommandWrapperTb.vhd CommandMuxPkg.o
	$(GHDL) -a $(GHDLFLAGS) $<
CommandWrapperSim.o: CommandWrapperSim.vhd $(OBJS) SimPty.o SimPtyIO.o
	$(GHDL) -a $(GHDLFLAGS) $<
SDRAMPkg.o: SDRAMPkg.vhd
	$(GHDL) -a $(GHDLFLAGS) $<

RamEmul.o: RamEmul.vhd
	$(GHDL) -a $(GHDLFLAGS) $<

SDRAMCtrl/RamEmul.vhd:
	$(error $@ missing)

%.o: %.vhd
	$(GHDL) -a $(GHDLFLAGS) $<

SimPtyIO.o: SimPtyIO.cc
	g++ -Wall -c -O2 -o $@ $<

# Files dependences
/opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/std_logic_1164.o: 
/opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/std_logic_1164-body.o:  /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/std_logic_1164.o
/opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/numeric_std.o:  /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/std_logic_1164.o
/opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/numeric_std-body.o:  /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/numeric_std.o
/opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/math_real.o: 
/opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/math_real-body.o:  /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/math_real.o
CommandMuxPkg.o:  /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/std_logic_1164.o /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/numeric_std.o /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/math_real.o /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/math_real-body.o BasicPkg.o
ByteStuffer.o:  /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/std_logic_1164.o
SFifo.o:  /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/std_logic_1164.o /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/numeric_std.o
ByteDeStuffer.o:  /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/std_logic_1164.o
CommandMux.o:  /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/std_logic_1164.o /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/numeric_std.o CommandMuxPkg.o
SynchronizerBit.o:  /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/std_logic_1164.o
BitBangIF.o:  /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/std_logic_1164.o /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/numeric_std.o /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/math_real.o SynchronizerBit.o BasicPkg.o
CommandBitBang.o:  /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/std_logic_1164.o /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/numeric_std.o /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/math_real.o CommandMuxPkg.o BitBangIF.o
MaxAdc.o:  /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/std_logic_1164.o /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/numeric_std.o CommandMuxPkg.o ILAWrapper.o AcqCtlPkg.o BasicPkg.o CicFilter.o PipelinedRShifter.o MulShifter.o
CommandWrapper.o:  /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/std_logic_1164.o /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/numeric_std.o CommandMuxPkg.o ByteDeStuffer.o ByteStuffer.o CommandMux.o CommandBitBang.o MaxAdc.o CommandAcqParm.o CommandSpi.o CommandReg.o SimpleBusPipeStage.o
CommandWrapperTb.o:  /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/std_logic_1164.o /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/std_logic_1164-body.o /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/numeric_std.o /opt/ghdl/v1.0.0-gcc/lib/ghdl/ieee/v93/numeric_std-body.o CommandMuxPkg.o ByteStuffer.o SFifo.o ByteDeStuffer.o CommandWrapper.o
CommandAcqParm.o: AcqCtlPkg.o CommandMuxPkg.o
PipelinedRShifterTb.o: PipelinedRShifter.o
CommandSpi.o: SpiBitShifter.o CommandMuxPkg.o
SpiFlashSim.o: SpiReg.o
CommandWrapperSim.o: SpiReg.o SpiChecker.o
CommandReg.o: CommandMuxPkg.o BasicPkg.o SimpleBusAsync.o

SimpleBusPipeStage.o: CommandMuxPkg.o BasicPkg.o

SimpleBusPipeStageTb.o: SimpleBusPipeStage.o CommandMuxPkg.o BasicPkg.o

SimpleBusAsync.o: SynchronizerBit.o

SpiShadowRegTb.o: SpiShadowReg.o SpiReg.o SpiChecker.o

SampleBufferBRAM.o: SynchronizerBit.o SDRAMPkg.o

SampleBufferSDRAM.o: SynchronizerBit.o SDRAMPkg.o GenericFifoAsync.o

CommandReg.o: CommandMuxPkg.o

SampleBufferTb.o: SampleBuffer$(SAMPLEBUFFER_TYPE).o

MulShifter.o PipelinedRShifter.o SpiBitShifter.o CommandBitBang.o SpiShadowReg.o: BasicPkg.o

CicFilterTb.o: CicFilter.o

SpiRegTb.o: SpiReg.o

GITVERSION:=$(shell git rev-parse --short=8 HEAD)
BRDVERSION:=01

.PHONY: .FORCE all clean test

clean:
	$(RM) $(OBJS) SimPty.o SimPtyIO.o CommandWrapperSim.o 
	$(RM) dump.ghw work-obj*.cf e~*.o
	$(RM) $(TESTS:%=%.o) $(TESTS)
